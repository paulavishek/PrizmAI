{% extends 'base.html' %}

{% block title %}Dashboard - PrizmAI{% endblock %}

{% block extra_css %}
<style>
    /* Styles for clickable metric cards */
    .metrics-card {
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .metrics-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Badge styles for priorities */
    .badge.priority-low {
        background-color: #6c757d;
        color: white;
    }

    .badge.priority-medium {
        background-color: #ffc107;
        color: black;
    }

    .badge.priority-high {
        background-color: #fd7e14;
        color: white;
    }

    .badge.priority-urgent {
        background-color: #dc3545;
        color: white;
    }

    /* Collapsible Demo Credentials Banner */
    .demo-credentials-banner {
        background: linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%);
        border: 2px solid #0288d1;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(2, 136, 209, 0.15);
        transition: all 0.3s ease;
    }

    .demo-credentials-banner.expanded {
        box-shadow: 0 6px 20px rgba(2, 136, 209, 0.25);
    }

    .demo-banner-header {
        padding: 1rem 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        user-select: none;
        transition: background-color 0.2s ease;
    }

    .demo-banner-header:hover {
        background: rgba(2, 136, 209, 0.08);
    }

    .demo-banner-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: #01579b;
    }

    .demo-banner-icon {
        font-size: 1.3rem;
        color: #0288d1;
    }

    .demo-toggle-icon {
        font-size: 1.2rem;
        color: #0288d1;
        transition: transform 0.3s ease;
    }

    .demo-credentials-banner.expanded .demo-toggle-icon {
        transform: rotate(180deg);
    }

    .demo-banner-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease, padding 0.4s ease;
        padding: 0 1.5rem;
    }

    .demo-credentials-banner.expanded .demo-banner-content {
        max-height: 500px;
        padding: 0 1.5rem 1.5rem 1.5rem;
    }

    .demo-users-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1rem;
    }

    @media (max-width: 992px) {
        .demo-users-row {
            grid-template-columns: 1fr;
        }
    }

    .demo-user-box {
        background: white;
        border-radius: 10px;
        padding: 1rem;
        border: 1px solid #b3e5fc;
        transition: all 0.3s ease;
    }

    .demo-user-box:hover {
        box-shadow: 0 4px 12px rgba(2, 136, 209, 0.2);
        transform: translateY(-3px);
    }

    .demo-user-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .demo-user-init {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
        color: white;
        flex-shrink: 0;
    }

    .demo-user-box.admin .demo-user-init {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .demo-user-box.developer .demo-user-init {
        background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
    }

    .demo-user-box.strategist .demo-user-init {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .demo-user-info h6 {
        margin: 0;
        font-size: 0.95rem;
        font-weight: 700;
        color: #01579b;
    }

    .demo-user-role {
        font-size: 0.75rem;
        color: #0288d1;
        margin: 0;
    }

    .demo-cred-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem;
        background: #f8f9fa;
        border-radius: 6px;
        margin-bottom: 0.4rem;
        font-size: 0.85rem;
    }

    .demo-cred-label {
        color: #6c757d;
        font-weight: 600;
    }

    .demo-cred-value {
        font-family: 'Courier New', monospace;
        font-weight: 700;
        color: #01579b;
        background: white;
        padding: 0.2rem 0.6rem;
        border-radius: 4px;
        border: 1px solid #b3e5fc;
    }

    /* Demo Skills List */
    .demo-skills-list {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid #e3f2fd;
    }

    .demo-skill-tag {
        display: inline-block;
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        color: #01579b;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-right: 0.3rem;
        margin-bottom: 0.3rem;
        border: 1px solid #90caf9;
    }

    /* Demo Login Button */
    .demo-login-btn {
        display: block;
        width: 100%;
        padding: 0.6rem;
        margin-top: 0.75rem;
        background: linear-gradient(135deg, #0288d1 0%, #0277bd 100%);
        color: white;
        text-align: center;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        border: none;
    }

    .demo-login-btn:hover {
        background: linear-gradient(135deg, #0277bd 0%, #01579b 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(2, 136, 209, 0.3);
    }

    /* Demo Boards Section */
    .demo-boards-section {
        padding-top: 1rem;
        border-top: 2px solid #b3e5fc;
    }

    .demo-boards-title {
        font-size: 1rem;
        font-weight: 700;
        color: #01579b;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
    }

    .demo-boards-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
    }

    @media (max-width: 992px) {
        .demo-boards-grid {
            grid-template-columns: 1fr;
        }
    }

    .demo-board-item {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        border: 1px solid #e3f2fd;
        text-align: center;
        transition: all 0.3s ease;
    }

    .demo-board-item:hover {
        border-color: #0288d1;
        box-shadow: 0 4px 12px rgba(2, 136, 209, 0.15);
        transform: translateY(-2px);
    }

    .demo-board-icon {
        width: 50px;
        height: 50px;
        margin: 0 auto 0.75rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .demo-board-item.software .demo-board-icon {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .demo-board-item.marketing .demo-board-icon {
        background: linear-gradient(135deg, #f857a6 0%, #ff5858 100%);
    }

    .demo-board-item.bug .demo-board-icon {
        background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
    }

    .demo-board-name {
        font-weight: 700;
        font-size: 0.9rem;
        color: #01579b;
        margin-bottom: 0.4rem;
    }

    .demo-board-desc {
        font-size: 0.75rem;
        color: #6c757d;
        line-height: 1.3;
    }

    /* Adjust max-height for expanded content with new sections */
    .demo-credentials-banner.expanded .demo-banner-content {
        max-height: 800px;
        padding: 0 1.5rem 1.5rem 1.5rem;
    }
    
    /* Welcome Modal Styles */
    .welcome-modal .modal-header {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        border-bottom: none;
    }
    .welcome-modal .modal-title {
        font-weight: 700;
    }
    .welcome-modal .modal-body {
        padding: 1.5rem;
    }
    .welcome-modal .modal-body .lead {
        margin-left: 0;
        padding-left: 0;
    }
    .welcome-modal .feature-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
        margin-left: 0;
        padding-left: 0;
        width: 100%;
    }
    .welcome-modal .feature-item > div:last-child {
        flex: 1;
        min-width: 0;
    }
    .welcome-modal .feature-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    .welcome-modal .feature-icon.users { background: #dbeafe; color: #2563eb; }
    .welcome-modal .feature-icon.boards { background: #dcfce7; color: #16a34a; }
    .welcome-modal .feature-icon.reset { background: #fef3c7; color: #d97706; }
    .welcome-modal .demo-user-badges-container {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-left: 0;
        padding-left: 0;
        justify-content: flex-start;
    }
    .welcome-modal .demo-user-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        background: #f3f4f6;
        border-radius: 20px;
        font-size: 0.85rem;
    }
    .welcome-modal .demo-user-badge i { margin-right: 5px; color: #6366f1; }
    .welcome-modal h6 {
        margin-left: 0;
        padding-left: 0;
        text-align: left;
    }
    .welcome-modal p {
        margin-left: 0;
        padding-left: 0;
        text-align: left;
    }
</style>
{% endblock %}

{% block content %}
<!-- Welcome Modal for First-time Users -->
{% if show_welcome_modal %}
<div class="modal fade welcome-modal" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="welcomeModalLabel">
                    <i class="fas fa-rocket me-2"></i>Welcome to PrizmAI!
                </h5>
            </div>
            <div class="modal-body">
                <p class="lead mb-4">
                    Your intelligent project management platform is ready. Here's what you need to know:
                </p>
                
                <div class="feature-item">
                    <div class="feature-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Demo Team Members</h6>
                        <p class="text-muted mb-2">
                            Explore collaboration features with these pre-configured demo users:
                        </p>
                        <div class="demo-user-badges-container">
                            <span class="demo-user-badge"><i class="fas fa-user-tie"></i> Alex Chen (Admin)</span>
                            <span class="demo-user-badge"><i class="fas fa-code"></i> Sam Rivera (Developer)</span>
                            <span class="demo-user-badge"><i class="fas fa-chart-line"></i> Jordan Taylor (Analyst)</span>
                        </div>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon boards">
                        <i class="fas fa-columns"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Sample Project Boards</h6>
                        <p class="text-muted mb-0">
                            Three demo boards are pre-loaded with realistic project data:
                            <strong>Software Development</strong>, <strong>Marketing Campaign</strong>, and <strong>Bug Tracking</strong>.
                            Feel free to explore, edit, or create your own!
                        </p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon reset">
                        <i class="fas fa-undo-alt"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Reset Anytime</h6>
                        <p class="text-muted mb-0">
                            Made changes you want to undo? Use the <strong>Reset Demo Data</strong> button
                            to restore all demo content to its original state. Your own boards and data are safe!
                        </p>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Pro Tip:</strong> In your real workspace, you'll invite actual team members.
                    The demo users help you explore features without needing a team right away!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-lg px-5" data-bs-dismiss="modal">
                    <i class="fas fa-arrow-right me-2"></i>Get Started
                </button>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
    welcomeModal.show();
});
</script>
{% endif %}

<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
            <div>
                <a href="{% url 'board_list' %}" class="d-none d-sm-inline-block btn btn-primary shadow-sm">
                    <i class="fas fa-plus fa-sm text-white-50 me-2"></i> View All Boards
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Collapsible Demo Credentials Banner -->
<div class="demo-credentials-banner" id="demoCredentialsBanner">
    <div class="demo-banner-header" onclick="toggleDemoBanner()">
        <div class="demo-banner-title">
            <i class="fas fa-user-shield demo-banner-icon"></i>
            <span>Demo Credentials</span>
            <small class="text-muted" style="font-weight: normal; font-size: 0.85rem;">(Click to expand)</small>
        </div>
        <i class="fas fa-chevron-down demo-toggle-icon"></i>
    </div>
    <div class="demo-banner-content">
        <div class="demo-users-row">
            <!-- Alex Chen - Admin -->
            <div class="demo-user-box admin">
                <div class="demo-user-header">
                    <div class="demo-user-init">AC</div>
                    <div class="demo-user-info">
                        <h6>Alex Chen</h6>
                        <p class="demo-user-role">Admin</p>
                    </div>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Username:</span>
                    <span class="demo-cred-value">alex_chen_demo</span>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Password:</span>
                    <span class="demo-cred-value">demo123</span>
                </div>
                <div class="demo-skills-list">
                    <p style="font-size: 0.8rem; font-weight: 600; margin-bottom: 0.4rem; color: #555;">Key Skills:</p>
                    <span class="demo-skill-tag">Project Management</span>
                    <span class="demo-skill-tag">Agile/Scrum</span>
                    <span class="demo-skill-tag">Leadership</span>
                </div>
                <a href="{% url 'quick_demo_login' 'alex_chen_demo' %}" class="demo-login-btn">
                    <i class="fas fa-sign-in-alt me-1"></i>Login as Alex
                </a>
            </div>

            <!-- Sam Rivera - Developer -->
            <div class="demo-user-box developer">
                <div class="demo-user-header">
                    <div class="demo-user-init">SR</div>
                    <div class="demo-user-info">
                        <h6>Sam Rivera</h6>
                        <p class="demo-user-role">Developer</p>
                    </div>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Username:</span>
                    <span class="demo-cred-value">sam_rivera_demo</span>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Password:</span>
                    <span class="demo-cred-value">demo123</span>
                </div>
                <div class="demo-skills-list">
                    <p style="font-size: 0.8rem; font-weight: 600; margin-bottom: 0.4rem; color: #555;">Key Skills:</p>
                    <span class="demo-skill-tag">Python</span>
                    <span class="demo-skill-tag">JavaScript</span>
                    <span class="demo-skill-tag">Django</span>
                    <span class="demo-skill-tag">React</span>
                </div>
                <a href="{% url 'quick_demo_login' 'sam_rivera_demo' %}" class="demo-login-btn">
                    <i class="fas fa-sign-in-alt me-1"></i>Login as Sam
                </a>
            </div>

            <!-- Jordan Taylor - Strategist -->
            <div class="demo-user-box strategist">
                <div class="demo-user-header">
                    <div class="demo-user-init">JT</div>
                    <div class="demo-user-info">
                        <h6>Jordan Taylor</h6>
                        <p class="demo-user-role">Strategist</p>
                    </div>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Username:</span>
                    <span class="demo-cred-value">jordan_taylor_demo</span>
                </div>
                <div class="demo-cred-item">
                    <span class="demo-cred-label">Password:</span>
                    <span class="demo-cred-value">demo123</span>
                </div>
                <div class="demo-skills-list">
                    <p style="font-size: 0.8rem; font-weight: 600; margin-bottom: 0.4rem; color: #555;">Key Skills:</p>
                    <span class="demo-skill-tag">Strategic Planning</span>
                    <span class="demo-skill-tag">Business Analysis</span>
                </div>
                <a href="{% url 'quick_demo_login' 'jordan_taylor_demo' %}" class="demo-login-btn">
                    <i class="fas fa-sign-in-alt me-1"></i>Login as Jordan
                </a>
            </div>
        </div>

        <!-- Demo Boards Section -->
        <div class="demo-boards-section mt-4">
            <h5 class="demo-boards-title">
                <i class="fas fa-folder-open me-2"></i>3 Pre-Populated Demo Boards
            </h5>
            <div class="demo-boards-grid">
                <!-- Software Development Board -->
                <div class="demo-board-item software">
                    <div class="demo-board-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <div class="demo-board-name">Software Development</div>
                    <div class="demo-board-desc">30 tasks with sprints, dependencies, and Gantt charts</div>
                </div>

                <!-- Marketing Campaign Board -->
                <div class="demo-board-item marketing">
                    <div class="demo-board-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <div class="demo-board-name">Marketing Campaign</div>
                    <div class="demo-board-desc">Content strategy, social media, and campaign execution</div>
                </div>

                <!-- Bug Tracking Board -->
                <div class="demo-board-item bug">
                    <div class="demo-board-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div class="demo-board-name">Bug Tracking</div>
                    <div class="demo-board-desc">Issue triage, priority management, and resolution</div>
                </div>
            </div>
        </div>

        <!-- AI Feature Notice -->
        <div class="alert alert-info mt-4" style="border-left: 4px solid #17a2b8; background-color: #e7f6f8; border-radius: 8px;">
            <div class="d-flex align-items-start">
                <i class="fas fa-info-circle me-3" style="font-size: 1.2rem; color: #17a2b8; margin-top: 2px;"></i>
                <div style="flex: 1;">
                    <strong style="color: #0c5460;">Note about AI Features:</strong>
                    <p style="margin-bottom: 0; margin-top: 0.5rem; color: #0c5460; font-size: 0.9rem;">
                        AI-powered features are not available for these demo users. Logging in with any of these demo accounts will not allow you to access AI features.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card primary shadow h-100 py-2 metrics-card" data-bs-toggle="modal"
            data-bs-target="#totalTasksModal">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Tasks</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ task_count }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clipboard-list stats-icon text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card success shadow h-100 py-2 metrics-card" data-bs-toggle="modal"
            data-bs-target="#completedTasksModal">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Completed Tasks</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ completed_count }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-check-circle stats-icon text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card warning shadow h-100 py-2 metrics-card" data-bs-toggle="modal"
            data-bs-target="#completionRateModal">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Completion Rate</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ completion_rate }}%</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-chart-line stats-icon text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card danger shadow h-100 py-2 metrics-card" data-bs-toggle="modal"
            data-bs-target="#overdueTasksModal">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Overdue Tasks</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ overdue_count }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-exclamation-triangle stats-icon text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card stats-card info shadow h-100 py-2 metrics-card" data-bs-toggle="modal"
            data-bs-target="#dueSoonTasksModal">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Tasks Due Soon</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ due_soon }}</div>
                        <small class="text-muted">Next 3 days</small>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-calendar-alt stats-icon text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- My Tasks Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary me-3">
                        <i class="fas fa-user-check me-2"></i>My Tasks
                    </h6>
                    <small class="text-muted">
                        ({{ my_tasks_count }} total{% if my_tasks_count != my_tasks|length %}, showing top 8{% endif %})
                    </small>
                </div>
                <div class="d-flex align-items-center">
                    <label for="taskSortSelect" class="form-label me-2 mb-0 small text-muted">Sort by:</label>
                    <select id="taskSortSelect" class="form-select form-select-sm" style="width: auto;"
                        onchange="changeSortOrder(this.value)">
                        <option value="urgency" {% if my_tasks_sort_by == 'urgency' %}selected{% endif %}>
                            🚨 Urgency (Overdue First)
                        </option>
                        <option value="due_date" {% if my_tasks_sort_by == 'due_date' %}selected{% endif %}>
                            📅 Due Date (Chronological)
                        </option>
                        <option value="priority" {% if my_tasks_sort_by == 'priority' %}selected{% endif %}>
                            🔥 Priority (High to Low)
                        </option>
                        <option value="recent" {% if my_tasks_sort_by == 'recent' %}selected{% endif %}>
                            🕒 Recent (Latest First)
                        </option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                {% if my_tasks %}
                <div class="row">
                    {% for task in my_tasks %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div
                            class="card h-100 border-left-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% elif task.priority == 'medium' %}info{% else %}success{% endif %} shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title mb-0">{{ task.title|truncatechars:40 }}</h6>
                                    <span class="badge priority-{{ task.priority }}">{{ task.priority|title }}</span>
                                </div>

                                {% if task.description %}
                                <p class="card-text text-muted small mb-2">{{ task.description|truncatechars:80 }}</p>
                                {% endif %}

                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-project-diagram me-1"></i>{{ task.column.board.name }} - {{ task.column.name }}
                                    </small>
                                </div>

                                {% if task.due_date %}
                                <div class="mb-2">
                                    <small
                                        class="{% if task.due_date < now and task.progress < 100 %}text-danger{% else %}text-muted{% endif %}">
                                        <i class="far fa-calendar-alt me-1"></i>{{ task.due_date|date:"M d, Y" }}
                                        {% if task.due_date < now and task.progress < 100 %}<span
                                            class="badge bg-danger ms-1">Overdue</span>{% endif %}
                                    </small>
                                </div>
                                {% endif %}

                                <div class="progress mb-2" style="height: 6px;">
                                    <div class="progress-bar {% if task.progress < 30 %}bg-danger{% elif task.progress < 70 %}bg-warning{% else %}bg-success{% endif %}"
                                        role="progressbar" style="width: {{ task.progress }}%"></div>
                                </div>
                                <small class="text-muted">{{ task.progress }}% complete</small>

                                <div class="text-end mt-2">
                                    <a href="{% url 'task_detail' task.id %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <a href="{% url 'board_detail' task.column.board.id %}"
                                        class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-project-diagram"></i> Board
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-user-check fa-4x text-gray-300 mb-3"></i>
                    <p class="mb-4">No tasks are currently assigned to you.</p>
                    <p class="text-muted">Tasks assigned to you will appear here for quick access.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Boards -->
<div class="row">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Your Boards</h6>
                <div>
                    {% regroup boards by is_official_demo_board as board_groups %}
                    {% for group in board_groups %}
                        {% if group.grouper %}
                            <button onclick="resetDemoData()" class="btn btn-sm btn-warning me-2" title="Reset all demo data to its original state">
                                <i class="fas fa-redo fa-sm"></i> Reset Demo Data
                            </button>
                        {% endif %}
                    {% endfor %}
                    <a href="{% url 'create_board' %}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus fa-sm"></i> New Board
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if boards %}
                <div class="row">
                    {% for board in boards|slice:":6" %}
                    <div class="col-md-4 mb-4">
                        <div class="card dashboard-card h-100 border-left-{% if board.is_official_demo_board %}warning{% else %}primary{% endif %} shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">{{ board.name }}</h5>
                                    {% if board.is_official_demo_board %}
                                        <span class="badge bg-warning text-dark" title="Demo board with sample data">
                                            <i class="fas fa-graduation-cap"></i> DEMO
                                        </span>
                                    {% endif %}
                                </div>
                                <p class="card-text text-muted small">
                                    {% if board.description %}
                                    {{ board.description|truncatechars:100 }}
                                    {% else %}
                                    No description provided.
                                    {% endif %}
                                </p>
                                <div class="text-end mt-2">
                                    <a href="{% url 'board_detail' board.id %}" class="btn btn-sm btn-primary">Open
                                        Board</a>
                                    <a href="{% url 'board_analytics' board.id %}"
                                        class="btn btn-sm btn-outline-secondary" title="Analytics">
                                        <i class="fas fa-chart-pie fa-sm"></i>
                                    </a>
                                    <a href="{% url 'budget_dashboard' board.id %}"
                                        class="btn btn-sm btn-outline-success" title="Budget & ROI">
                                        <i class="fas fa-dollar-sign fa-sm"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent border-top-0">
                                <small class="text-muted">Created {{ board.created_at|date:"M d, Y" }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-clipboard-list fa-4x text-gray-300 mb-3"></i>
                    <p class="mb-4">You don't have any boards yet.</p>
                    <a href="{% url 'board_list' %}" class="btn btn-primary">
                        <i class="fas fa-plus fa-sm"></i> Create Your First Board
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Metric Detail Modals -->
<!-- Total Tasks Modal -->
<div class="modal fade" id="totalTasksModal" tabindex="-1" aria-labelledby="totalTasksModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="totalTasksModalLabel">All Tasks</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if all_tasks %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Board</th>
                            <th>Column</th>
                            <th>Priority</th>
                            <th>Progress</th>
                            <th>Assigned To</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in all_tasks %}
                        <tr>
                            <td>{{ task.title }}</td>
                            <td>{{ task.column.board.name }}</td>
                            <td>{{ task.column.name }}</td>
                            <td><span class="badge priority-{{ task.priority }}">{{ task.priority|title }}</span></td>
                            <td>
                                <div class="progress" style="height: 15px;">
                                    <div class="progress-bar bg-info" role="progressbar"
                                        style="width: {{ task.progress }}%">
                                        <small>{{ task.progress }}%</small>
                                    </div>
                                </div>
                            </td>
                            <td>{{ task.assigned_to.username|default:"Unassigned" }}</td>
                            <td>
                                <a href="{% url 'task_detail' task.id %}"
                                    class="btn btn-sm btn-outline-primary">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                    <p class="lead">No tasks found!</p>
                </div>
                {% endif %}
                
                {% if all_tasks.has_other_pages %}
                <nav aria-label="All tasks pagination" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if all_tasks.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?all_tasks_page=1{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="totalTasksModal">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?all_tasks_page={{ all_tasks.previous_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="totalTasksModal">Previous</a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">Page {{ all_tasks.number }} of {{ all_tasks.paginator.num_pages }}</span>
                        </li>
                        
                        {% if all_tasks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?all_tasks_page={{ all_tasks.next_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="totalTasksModal">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?all_tasks_page={{ all_tasks.paginator.num_pages }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="totalTasksModal">Last</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <small class="text-muted">Showing {{ all_tasks.start_index }} to {{ all_tasks.end_index }} of {{ all_tasks.paginator.count }} tasks</small>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Completed Tasks Modal -->
<div class="modal fade" id="completedTasksModal" tabindex="-1" aria-labelledby="completedTasksModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="completedTasksModalLabel">Completed Tasks</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if completed_tasks %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Board</th>
                            <th>Priority</th>
                            <th>Completed On</th>
                            <th>Assigned To</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in completed_tasks %}
                        <tr>
                            <td>{{ task.title }}</td>
                            <td>{{ task.column.board.name }}</td>
                            <td><span class="badge priority-{{ task.priority }}">{{ task.priority|title }}</span></td>
                            <td>{{ task.updated_at|date:"M d, Y" }}</td>
                            <td>{{ task.assigned_to.username|default:"Unassigned" }}</td>
                            <td>
                                <a href="{% url 'task_detail' task.id %}"
                                    class="btn btn-sm btn-outline-primary">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-check-circle fa-3x text-muted mb-3"></i>
                    <p class="lead">No completed tasks yet!</p>
                </div>
                {% endif %}
                
                {% if completed_tasks.has_other_pages %}
                <nav aria-label="Completed tasks pagination" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if completed_tasks.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?completed_tasks_page=1{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="completedTasksModal">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?completed_tasks_page={{ completed_tasks.previous_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="completedTasksModal">Previous</a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">Page {{ completed_tasks.number }} of {{ completed_tasks.paginator.num_pages }}</span>
                        </li>
                        
                        {% if completed_tasks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?completed_tasks_page={{ completed_tasks.next_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="completedTasksModal">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?completed_tasks_page={{ completed_tasks.paginator.num_pages }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="completedTasksModal">Last</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <small class="text-muted">Showing {{ completed_tasks.start_index }} to {{ completed_tasks.end_index }} of {{ completed_tasks.paginator.count }} tasks</small>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Completion Rate Modal -->
<div class="modal fade" id="completionRateModal" tabindex="-1" aria-labelledby="completionRateModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="completionRateModalLabel">Task Completion Overview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card bg-success bg-opacity-10">
                            <div class="card-body text-center">
                                <h3 class="text-success">{{ completed_count }}</h3>
                                <p>Completed Tasks</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-primary bg-opacity-10">
                            <div class="card-body text-center">
                                <h3 class="text-primary">{{ remaining_tasks }}</h3>
                                <p>Remaining Tasks</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="progress mb-3" style="height: 30px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ completion_rate }}%">
                        {{ completion_rate }}% Complete
                    </div>
                </div>

                <div class="text-center">
                    <h4>Overall Completion Rate: {{ completion_rate }}%</h4>
                    {% if completion_rate >= 80 %}
                    <p class="text-success"><i class="fas fa-check-circle"></i> Excellent progress! Keep up the great
                        work!</p>
                    {% elif completion_rate >= 60 %}
                    <p class="text-warning"><i class="fas fa-clock"></i> Good progress, but there's room for
                        improvement.</p>
                    {% else %}
                    <p class="text-danger"><i class="fas fa-exclamation-triangle"></i> Consider focusing on completing
                        more tasks.</p>
                    {% endif %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Overdue Tasks Modal -->
<div class="modal fade" id="overdueTasksModal" tabindex="-1" aria-labelledby="overdueTasksModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="overdueTasksModalLabel">Overdue Tasks</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if overdue_tasks %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Board</th>
                            <th>Due Date</th>
                            <th>Days Overdue</th>
                            <th>Priority</th>
                            <th>Assigned To</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in overdue_tasks %}
                        <tr>
                            <td>{{ task.title }}</td>
                            <td>{{ task.column.board.name }}</td>
                            <td class="text-danger">{{ task.due_date|date:"M d, Y" }}</td>
                            <td>
                                <span class="badge bg-danger">{{ task.due_date|timesince }} ago</span>
                            </td>
                            <td><span class="badge priority-{{ task.priority }}">{{ task.priority|title }}</span></td>
                            <td>{{ task.assigned_to.username|default:"Unassigned" }}</td>
                            <td>
                                <a href="{% url 'task_detail' task.id %}"
                                    class="btn btn-sm btn-outline-primary">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <p class="lead">No overdue tasks!</p>
                    <p class="text-muted">Great job staying on top of deadlines!</p>
                </div>
                {% endif %}
                
                {% if overdue_tasks.has_other_pages %}
                <nav aria-label="Overdue tasks pagination" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if overdue_tasks.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?overdue_tasks_page=1{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="overdueTasksModal">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?overdue_tasks_page={{ overdue_tasks.previous_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="overdueTasksModal">Previous</a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">Page {{ overdue_tasks.number }} of {{ overdue_tasks.paginator.num_pages }}</span>
                        </li>
                        
                        {% if overdue_tasks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?overdue_tasks_page={{ overdue_tasks.next_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="overdueTasksModal">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?overdue_tasks_page={{ overdue_tasks.paginator.num_pages }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="overdueTasksModal">Last</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <small class="text-muted">Showing {{ overdue_tasks.start_index }} to {{ overdue_tasks.end_index }} of {{ overdue_tasks.paginator.count }} tasks</small>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Due Soon Tasks Modal -->
<div class="modal fade" id="dueSoonTasksModal" tabindex="-1" aria-labelledby="dueSoonTasksModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="dueSoonTasksModalLabel">Tasks Due Soon</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if due_soon_tasks %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Board</th>
                            <th>Due Date</th>
                            <th>Days Remaining</th>
                            <th>Priority</th>
                            <th>Progress</th>
                            <th>Assigned To</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in due_soon_tasks %}
                        <tr>
                            <td>{{ task.title }}</td>
                            <td>{{ task.column.board.name }}</td>
                            <td>{{ task.due_date|date:"M d, Y" }}</td>
                            <td>
                                <span class="badge bg-warning">{{ task.due_date|timeuntil }}</span>
                            </td>
                            <td><span class="badge priority-{{ task.priority }}">{{ task.priority|title }}</span></td>
                            <td>
                                <div class="progress" style="height: 15px;">
                                    <div class="progress-bar bg-info" role="progressbar"
                                        style="width: {{ task.progress }}%">
                                        <small>{{ task.progress }}%</small>
                                    </div>
                                </div>
                            </td>
                            <td>{{ task.assigned_to.username|default:"Unassigned" }}</td>
                            <td>
                                <a href="{% url 'task_detail' task.id %}"
                                    class="btn btn-sm btn-outline-primary">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-calendar-check fa-3x text-muted mb-3"></i>
                    <p class="lead">No tasks due soon!</p>
                    <p class="text-muted">You're ahead of schedule!</p>
                </div>
                {% endif %}
                
                {% if due_soon_tasks.has_other_pages %}
                <nav aria-label="Due soon tasks pagination" class="mt-3">
                    <ul class="pagination justify-content-center">
                        {% if due_soon_tasks.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?due_soon_tasks_page=1{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="dueSoonTasksModal">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?due_soon_tasks_page={{ due_soon_tasks.previous_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="dueSoonTasksModal">Previous</a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">Page {{ due_soon_tasks.number }} of {{ due_soon_tasks.paginator.num_pages }}</span>
                        </li>
                        
                        {% if due_soon_tasks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?due_soon_tasks_page={{ due_soon_tasks.next_page_number }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="dueSoonTasksModal">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?due_soon_tasks_page={{ due_soon_tasks.paginator.num_pages }}{% if my_tasks_sort_by %}&sort_tasks={{ my_tasks_sort_by }}{% endif %}" data-modal="dueSoonTasksModal">Last</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <small class="text-muted">Showing {{ due_soon_tasks.start_index }} to {{ due_soon_tasks.end_index }} of {{ due_soon_tasks.paginator.count }} tasks</small>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Lean Six Sigma Info Modal -->
<div class="modal fade" id="leanSixSigmaInfoModal" tabindex="-1" aria-labelledby="leanSixSigmaInfoModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="leanSixSigmaInfoModalLabel">
                    <i class="fas fa-chart-line me-2"></i> Lean Six Sigma Features in Pri<span
                        class="stylish-z">z</span>mAI
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5>What is Lean Six Sigma?</h5>
                        <p>Lean Six Sigma is a methodology that combines Lean (eliminating waste) and Six Sigma
                            (reducing variation) to improve business processes. Pri<span class="stylish-z">z</span>mAI
                            now integrates key Lean Six Sigma principles to help you visualize, categorize, and optimize
                            your work.</p>
                    </div>
                </div>

                <h5 class="mb-3">Key Features:</h5>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <i class="fas fa-tags me-1"></i> Value-Added Task Categorization
                            </div>
                            <div class="card-body">
                                <p>Categorize tasks using Lean Six Sigma labels:</p>
                                <ul>
                                    <li><strong class="text-success">Value-Added (VA):</strong> Activities customers
                                        value and would pay for</li>
                                    <li><strong class="text-warning">Necessary Non-Value-Added (NNVA):</strong> Required
                                        but non-value adding activities</li>
                                    <li><strong class="text-danger">Waste/Eliminate (NVA):</strong> Activities that
                                        should be eliminated</li>
                                </ul>
                                <p class="small text-muted">Access from: Task creation/editing forms and the label
                                    management page</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-chart-pie me-1"></i> Process Efficiency Analytics
                            </div>
                            <div class="card-body">
                                <p>Gain insights with specialized Lean Six Sigma metrics:</p>
                                <ul>
                                    <li>Value-Added percentage calculation</li>
                                    <li>Distribution of VA/NNVA/Waste tasks</li>
                                    <li>Process improvement recommendations</li>
                                </ul>
                                <p class="small text-muted">Access from: Board Analytics page</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <i class="fas fa-filter me-1"></i> Lean Six Sigma Filtering
                            </div>
                            <div class="card-body">
                                <p>Filter tasks by value category to focus efforts:</p>
                                <ul>
                                    <li>Focus on value-adding tasks first</li>
                                    <li>Identify waste for elimination</li>
                                    <li>Balance necessary non-value activities</li>
                                </ul>
                                <p class="small text-muted">Access from: Board task search panel</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <i class="fas fa-lightbulb me-1"></i> Process Improvement Tips
                            </div>
                            <div class="card-body">
                                <p>Get actionable recommendations based on your task distribution:</p>
                                <ul>
                                    <li>Ways to eliminate identified waste</li>
                                    <li>How to increase value-added percentage</li>
                                    <li>Strategies for continuous improvement</li>
                                </ul>
                                <p class="small text-muted">Access from: Board Analytics page</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Getting Started:</strong> Begin by adding Lean Six Sigma labels to your tasks. Visit the
                    "Manage Labels" section within any board and click "Add Default Lean Six Sigma Labels".
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<!-- Analytics CSS for clickable metric cards -->
<link rel="stylesheet" href="{% static 'css/analytics.css' %}">

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize metric cards to open modals when clicked
        const metricCards = document.querySelectorAll('.metrics-card');
        metricCards.forEach(card => {
            card.addEventListener('click', function () {
                const targetModal = this.getAttribute('data-bs-target');
                const modalElement = document.querySelector(targetModal);
                if (modalElement) {
                    const modalInstance = new bootstrap.Modal(modalElement);
                    modalInstance.show();
                }
            });
        });

        // Enhanced modal cleanup for proper scrolling restoration
        const allModals = document.querySelectorAll('.modal');
        allModals.forEach(modal => {
            // Handle modal hide events
            modal.addEventListener('hidden.bs.modal', function () {
                // Ensure body can scroll again
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';

                // Remove any orphaned backdrops
                document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                    backdrop.remove();
                });

                // Remove aria-hidden and restore focus
                this.setAttribute('aria-hidden', 'true');
                document.body.focus();
            });

            // Handle modal shown events
            modal.addEventListener('shown.bs.modal', function () {
                // Ensure modal is properly visible
                this.removeAttribute('aria-hidden');
            });
        });

        // Additional cleanup for close buttons
        document.querySelectorAll('.modal button[data-bs-dismiss="modal"]').forEach(btn => {
            btn.addEventListener('click', function () {
                const modal = this.closest('.modal');
                if (modal) {
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    if (modalInstance) {
                        modalInstance.hide();
                    }
                }
            });
        });

        // Global escape key handler for better modal management
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    const modalInstance = bootstrap.Modal.getInstance(openModal);
                    if (modalInstance) {
                        modalInstance.hide();
                    }
                }
            }
        });

        // Fix any existing modal state issues on page load
        setTimeout(function () {
            // Ensure no modal backdrops are left over
            document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                backdrop.remove();
            });

            // Ensure body can scroll
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }, 100);
    });

    // Function to handle task sorting preference change
    function changeSortOrder(sortBy) {
        // Get current URL and update the sort parameter
        const url = new URL(window.location);
        url.searchParams.set('sort_tasks', sortBy);

        // Add a subtle loading indication
        const selectElement = document.getElementById('taskSortSelect');
        const originalHtml = selectElement.innerHTML;
        selectElement.disabled = true;

        // Show loading state briefly
        const loadingText = document.createElement('option');
        loadingText.value = '';
        loadingText.textContent = '🔄 Updating...';
        loadingText.selected = true;
        selectElement.innerHTML = '';
        selectElement.appendChild(loadingText);

        // Redirect to update the page with new sort order
        setTimeout(() => {
            window.location.href = url.toString();
        }, 300);
    }

    // Toggle Demo Credentials Banner
    function toggleDemoBanner() {
        const banner = document.getElementById('demoCredentialsBanner');
        banner.classList.toggle('expanded');

        // Save state to localStorage
        const isExpanded = banner.classList.contains('expanded');
        localStorage.setItem('demoBannerExpanded', isExpanded);
    }

    // Reset Demo Data Function
    function resetDemoData() {
        if (confirm('Reset Demo Environment?\n\nThis will:\n• Delete all boards, tasks, and data you created\n• Restore all original demo data to its initial state\n• Fix any demo data you modified\n\nThis cannot be undone.')) {
            // Show loading indicator
            const btn = event.target.closest('button');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
            btn.disabled = true;
            
            // Make AJAX request to reset
            fetch('/demo/reset/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': getCookie('csrftoken'),
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('✅ Demo reset successfully!\n\nAll demo data has been restored to its original state.');
                    location.reload();
                } else {
                    alert('Failed to reset demo: ' + (data.message || 'Unknown error'));
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error resetting demo:', error);
                alert('Failed to reset demo. Please try again.');
                btn.innerHTML = originalHtml;
                btn.disabled = false;
            });
        }
    }
    
    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Restore demo banner state on page load
    document.addEventListener('DOMContentLoaded', function () {
        const banner = document.getElementById('demoCredentialsBanner');
        if (banner) {
            const wasExpanded = localStorage.getItem('demoBannerExpanded') === 'true';
            if (wasExpanded) {
                banner.classList.add('expanded');
            }
        }
        
        // Handle pagination clicks within modals
        handleModalPagination();
    });
    
    // Function to handle pagination within modals via AJAX
    function handleModalPagination() {
        // Get all pagination links in modals
        const paginationLinks = document.querySelectorAll('.modal .pagination a.page-link');
        
        paginationLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const url = this.getAttribute('href');
                const modalId = this.getAttribute('data-modal');
                const modal = document.getElementById(modalId);
                
                if (!modal) return;
                
                // Show loading state
                const modalBody = modal.querySelector('.modal-body');
                const originalContent = modalBody.innerHTML;
                modalBody.innerHTML = '<div class=\"text-center py-5\"><i class=\"fas fa-spinner fa-spin fa-3x text-primary\"></i><p class=\"mt-3\">Loading...</p></div>';
                
                // Fetch the new page content
                fetch(url, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    // Parse the HTML response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Extract the modal content from the response
                    const newModal = doc.getElementById(modalId);
                    if (newModal) {
                        const newModalBody = newModal.querySelector('.modal-body');
                        const newModalFooter = newModal.querySelector('.modal-footer');
                        
                        if (newModalBody) {
                            modal.querySelector('.modal-body').innerHTML = newModalBody.innerHTML;
                        }
                        if (newModalFooter) {
                            modal.querySelector('.modal-footer').innerHTML = newModalFooter.innerHTML;
                        }
                        
                        // Re-attach pagination handlers
                        handleModalPagination();
                    } else {
                        modalBody.innerHTML = originalContent;
                    }
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    modalBody.innerHTML = '<div class=\"text-center py-5\"><i class=\"fas fa-exclamation-triangle fa-3x text-danger\"></i><p class=\"mt-3\">Error loading content. Please try again.</p></div>';
                });
            });
        });
    }
</script>
{% endblock %}