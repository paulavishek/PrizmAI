# Generated by Django 5.2.3 on 2025-11-20 12:51

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('kanban', '0039_board_baseline_complexity_total_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ProjectRetrospective',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(help_text='Retrospective title', max_length=200)),
                ('retrospective_type', models.CharField(choices=[('sprint', 'Sprint Retrospective'), ('project', 'Project Retrospective'), ('milestone', 'Milestone Retrospective'), ('quarterly', 'Quarterly Review')], default='sprint', max_length=20)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('generated', 'Generated by AI'), ('reviewed', 'Reviewed by Team'), ('finalized', 'Finalized'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('period_start', models.DateField(help_text='Start date of period being analyzed')),
                ('period_end', models.DateField(help_text='End date of period being analyzed')),
                ('metrics_snapshot', models.JSONField(default=dict, help_text='Snapshot of key metrics: tasks completed, velocity, quality, etc.')),
                ('what_went_well', models.TextField(blank=True, help_text='AI-identified positive aspects and successes')),
                ('what_needs_improvement', models.TextField(blank=True, help_text='AI-identified challenges and areas for improvement')),
                ('lessons_learned', models.JSONField(default=list, help_text='List of lessons learned with categories and priorities')),
                ('key_achievements', models.JSONField(default=list, help_text='Notable achievements and milestones')),
                ('challenges_faced', models.JSONField(default=list, help_text='Key challenges encountered with impact assessment')),
                ('improvement_recommendations', models.JSONField(default=list, help_text='AI-generated actionable improvement recommendations')),
                ('overall_sentiment_score', models.DecimalField(blank=True, decimal_places=2, help_text='AI-calculated sentiment score (0=negative, 1=positive)', max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('team_morale_indicator', models.CharField(blank=True, choices=[('low', 'Low'), ('moderate', 'Moderate'), ('high', 'High'), ('excellent', 'Excellent')], max_length=20, null=True)),
                ('performance_trend', models.CharField(choices=[('improving', 'Improving'), ('stable', 'Stable'), ('declining', 'Declining'), ('insufficient_data', 'Insufficient Data')], default='insufficient_data', max_length=20)),
                ('ai_generated_at', models.DateTimeField(blank=True, help_text='When AI analysis was performed', null=True)),
                ('ai_confidence_score', models.DecimalField(decimal_places=2, default=0.75, help_text='AI confidence in the analysis (0-1)', max_digits=3, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('ai_model_used', models.CharField(default='gemini-2.0-flash-exp', help_text='AI model used for generation', max_length=50)),
                ('team_notes', models.TextField(blank=True, help_text='Additional notes from team discussion')),
                ('team_feedback_on_ai', models.TextField(blank=True, help_text='Team feedback on AI-generated insights')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('finalized_at', models.DateTimeField(blank=True, null=True)),
                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='retrospectives', to='kanban.board')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_retrospectives', to=settings.AUTH_USER_MODEL)),
                ('finalized_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='finalized_retrospectives', to=settings.AUTH_USER_MODEL)),
                ('meeting_transcript', models.ForeignKey(blank=True, help_text='Link to retrospective meeting transcript if applicable', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='retrospectives', to='kanban.meetingtranscript')),
                ('previous_retrospective', models.ForeignKey(blank=True, help_text='Link to previous retrospective for trend analysis', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='subsequent_retrospectives', to='kanban.projectretrospective')),
            ],
            options={
                'verbose_name': 'Project Retrospective',
                'verbose_name_plural': 'Project Retrospectives',
                'ordering': ['-period_end', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LessonLearned',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(help_text='Brief lesson title', max_length=200)),
                ('description', models.TextField(help_text='Detailed description of the lesson')),
                ('category', models.CharField(choices=[('process', 'Process Improvement'), ('technical', 'Technical'), ('communication', 'Communication'), ('planning', 'Planning & Estimation'), ('quality', 'Quality Assurance'), ('teamwork', 'Teamwork & Collaboration'), ('tools', 'Tools & Technology'), ('risk_management', 'Risk Management'), ('customer', 'Customer Relations'), ('other', 'Other')], max_length=30)),
                ('priority', models.CharField(choices=[('low', 'Low - Nice to have'), ('medium', 'Medium - Should implement'), ('high', 'High - Must implement'), ('critical', 'Critical - Immediate action')], default='medium', max_length=20)),
                ('trigger_event', models.TextField(blank=True, help_text='What triggered this lesson? (event, problem, success)')),
                ('impact_description', models.TextField(blank=True, help_text='Impact this lesson had on the project')),
                ('recommended_action', models.TextField(help_text='Recommended action to apply this lesson')),
                ('status', models.CharField(choices=[('identified', 'Identified'), ('planned', 'Action Planned'), ('in_progress', 'In Progress'), ('implemented', 'Implemented'), ('validated', 'Validated/Successful'), ('not_applicable', 'No Longer Applicable')], default='identified', max_length=20)),
                ('implementation_date', models.DateField(blank=True, help_text='When action was implemented', null=True)),
                ('validation_date', models.DateField(blank=True, help_text='When improvement was validated', null=True)),
                ('expected_benefit', models.TextField(blank=True, help_text='Expected benefit if implemented')),
                ('actual_benefit', models.TextField(blank=True, help_text='Actual measured benefit after implementation')),
                ('success_metrics', models.JSONField(blank=True, default=list, help_text="Metrics to measure success: [{'metric': 'velocity', 'before': 10, 'after': 15}]")),
                ('ai_suggested', models.BooleanField(default=False, help_text='Was this lesson AI-identified?')),
                ('ai_confidence', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('is_recurring_issue', models.BooleanField(default=False, help_text='Has this lesson appeared in multiple retrospectives?')),
                ('recurrence_count', models.IntegerField(default=1, help_text='Number of times this type of lesson has occurred')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('action_owner', models.ForeignKey(blank=True, help_text='Person responsible for implementing', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='owned_lessons', to=settings.AUTH_USER_MODEL)),
                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons_learned', to='kanban.board')),
                ('related_lessons', models.ManyToManyField(blank=True, help_text='Related lessons from other retrospectives', to='kanban.lessonlearned')),
                ('retrospective', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lessons', to='kanban.projectretrospective')),
            ],
            options={
                'verbose_name': 'Lesson Learned',
                'verbose_name_plural': 'Lessons Learned',
                'ordering': ['-priority', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ImprovementMetric',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('metric_type', models.CharField(choices=[('velocity', 'Team Velocity'), ('quality', 'Quality Score'), ('cycle_time', 'Cycle Time'), ('defect_rate', 'Defect Rate'), ('estimation_accuracy', 'Estimation Accuracy'), ('team_satisfaction', 'Team Satisfaction'), ('customer_satisfaction', 'Customer Satisfaction'), ('technical_debt', 'Technical Debt'), ('automation_coverage', 'Automation Coverage'), ('deployment_frequency', 'Deployment Frequency'), ('custom', 'Custom Metric')], max_length=30)),
                ('metric_name', models.CharField(help_text='Display name for metric', max_length=100)),
                ('description', models.TextField(blank=True, help_text='What this metric measures')),
                ('metric_value', models.DecimalField(decimal_places=2, help_text='Current metric value', max_digits=10)),
                ('previous_value', models.DecimalField(blank=True, decimal_places=2, help_text="Previous period's value", max_digits=10, null=True)),
                ('target_value', models.DecimalField(blank=True, decimal_places=2, help_text='Target/goal value', max_digits=10, null=True)),
                ('change_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Absolute change from previous value', max_digits=10, null=True)),
                ('change_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Percentage change from previous value', max_digits=6, null=True)),
                ('trend', models.CharField(choices=[('improving', 'Improving'), ('stable', 'Stable'), ('declining', 'Declining'), ('no_data', 'No Previous Data')], default='no_data', max_length=20)),
                ('unit_of_measure', models.CharField(default='points', help_text="Unit (e.g., 'tasks', 'hours', 'percentage', 'score')", max_length=50)),
                ('higher_is_better', models.BooleanField(default=True, help_text='Is higher value better? (False if lower is better)')),
                ('measured_at', models.DateField(help_text='Date when metric was measured')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='improvement_metrics', to='kanban.board')),
                ('retrospective', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='metrics', to='kanban.projectretrospective')),
            ],
            options={
                'verbose_name': 'Improvement Metric',
                'verbose_name_plural': 'Improvement Metrics',
                'ordering': ['-measured_at', 'metric_type'],
            },
        ),
        migrations.CreateModel(
            name='RetrospectiveActionItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(help_text='Action item title', max_length=200)),
                ('description', models.TextField(help_text='Detailed description of action')),
                ('action_type', models.CharField(choices=[('process_change', 'Process Change'), ('tool_adoption', 'Tool Adoption'), ('training', 'Training/Learning'), ('documentation', 'Documentation'), ('technical_improvement', 'Technical Improvement'), ('team_building', 'Team Building'), ('communication', 'Communication Enhancement'), ('other', 'Other')], max_length=30)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('blocked', 'Blocked'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('target_completion_date', models.DateField(blank=True, help_text='Target date for completion', null=True)),
                ('actual_completion_date', models.DateField(blank=True, help_text='Actual completion date', null=True)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='medium', max_length=20)),
                ('expected_impact', models.TextField(blank=True, help_text='Expected impact if completed')),
                ('actual_impact', models.TextField(blank=True, help_text='Actual measured impact')),
                ('blocked_reason', models.TextField(blank=True, help_text='Reason why action is blocked')),
                ('blocked_date', models.DateField(blank=True, null=True)),
                ('progress_percentage', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('progress_notes', models.TextField(blank=True, help_text='Notes on progress and updates')),
                ('ai_suggested', models.BooleanField(default=False)),
                ('ai_confidence', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_retrospective_actions', to=settings.AUTH_USER_MODEL)),
                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='retrospective_actions', to='kanban.board')),
                ('related_lesson', models.ForeignKey(blank=True, help_text='Related lesson learned', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='action_items', to='kanban.lessonlearned')),
                ('related_task', models.ForeignKey(blank=True, help_text='Related project task', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='retrospective_actions', to='kanban.task')),
                ('retrospective', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='action_items', to='kanban.projectretrospective')),
                ('stakeholders', models.ManyToManyField(blank=True, help_text='Other people involved in this action', related_name='stakeholder_retrospective_actions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Retrospective Action Item',
                'verbose_name_plural': 'Retrospective Action Items',
                'ordering': ['-priority', 'target_completion_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RetrospectiveTrend',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('analysis_date', models.DateField(auto_now_add=True, help_text='When trend analysis was performed')),
                ('period_type', models.CharField(choices=[('quarterly', 'Quarterly'), ('yearly', 'Yearly'), ('all_time', 'All Time')], default='quarterly', max_length=20)),
                ('retrospectives_analyzed', models.IntegerField(default=0, help_text='Number of retrospectives included in analysis')),
                ('total_lessons_learned', models.IntegerField(default=0)),
                ('lessons_implemented', models.IntegerField(default=0)),
                ('lessons_validated', models.IntegerField(default=0)),
                ('implementation_rate', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of lessons implemented', max_digits=5)),
                ('total_action_items', models.IntegerField(default=0)),
                ('action_items_completed', models.IntegerField(default=0)),
                ('completion_rate', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of actions completed', max_digits=5)),
                ('recurring_issues', models.JSONField(default=list, help_text="Issues that keep appearing: [{'issue': 'description', 'count': 3}]")),
                ('top_improvement_categories', models.JSONField(default=list, help_text='Most common improvement categories')),
                ('velocity_trend', models.CharField(blank=True, choices=[('improving', 'Improving'), ('stable', 'Stable'), ('declining', 'Declining')], max_length=20, null=True)),
                ('quality_trend', models.CharField(blank=True, choices=[('improving', 'Improving'), ('stable', 'Stable'), ('declining', 'Declining')], max_length=20, null=True)),
                ('ai_insights', models.TextField(blank=True, help_text='AI-generated insights about trends')),
                ('key_recommendations', models.JSONField(default=list, help_text='Top recommendations based on trends')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('board', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='retrospective_trends', to='kanban.board')),
            ],
            options={
                'verbose_name': 'Retrospective Trend',
                'verbose_name_plural': 'Retrospective Trends',
                'ordering': ['-analysis_date'],
            },
        ),
        migrations.AddIndex(
            model_name='projectretrospective',
            index=models.Index(fields=['board', '-period_end'], name='kanban_proj_board_i_09932e_idx'),
        ),
        migrations.AddIndex(
            model_name='projectretrospective',
            index=models.Index(fields=['retrospective_type', 'status'], name='kanban_proj_retrosp_7bce2b_idx'),
        ),
        migrations.AddIndex(
            model_name='projectretrospective',
            index=models.Index(fields=['-created_at'], name='kanban_proj_created_d79666_idx'),
        ),
        migrations.AddIndex(
            model_name='lessonlearned',
            index=models.Index(fields=['board', 'status'], name='kanban_less_board_i_49684f_idx'),
        ),
        migrations.AddIndex(
            model_name='lessonlearned',
            index=models.Index(fields=['category', 'priority'], name='kanban_less_categor_747474_idx'),
        ),
        migrations.AddIndex(
            model_name='lessonlearned',
            index=models.Index(fields=['retrospective'], name='kanban_less_retrosp_14c964_idx'),
        ),
        migrations.AddIndex(
            model_name='improvementmetric',
            index=models.Index(fields=['board', 'metric_type', '-measured_at'], name='kanban_impr_board_i_3b91fc_idx'),
        ),
        migrations.AddIndex(
            model_name='improvementmetric',
            index=models.Index(fields=['retrospective'], name='kanban_impr_retrosp_53f72a_idx'),
        ),
        migrations.AddIndex(
            model_name='retrospectiveactionitem',
            index=models.Index(fields=['retrospective', 'status'], name='kanban_retr_retrosp_700a53_idx'),
        ),
        migrations.AddIndex(
            model_name='retrospectiveactionitem',
            index=models.Index(fields=['board', 'assigned_to'], name='kanban_retr_board_i_e8e70e_idx'),
        ),
        migrations.AddIndex(
            model_name='retrospectiveactionitem',
            index=models.Index(fields=['status', 'priority'], name='kanban_retr_status_87b0c1_idx'),
        ),
        migrations.AddIndex(
            model_name='retrospectivetrend',
            index=models.Index(fields=['board', '-analysis_date'], name='kanban_retr_board_i_9844e5_idx'),
        ),
    ]
