# AI Coach Suggestion Types: Brief vs. Detailed Format

## Your Observation

You noticed that most AI Coach suggestions appear as **brief one-sentence statements**, but one particular suggestion ("Team velocity declining (20% drop)") displays with much more detail including:
- **Why this matters** section
- **Recommended Actions** (multiple detailed steps)
- **Expected Impact** section

And you correctly noted: **The detailed format is much more useful!**

---

## Why Some Suggestions Are Detailed and Others Are Brief

The AI Coach system uses **two generation methods**:

### 1. **Rule-Based Suggestions** (Brief Format) üîß
- Generated by the `CoachingRuleEngine` 
- Simple pattern detection (e.g., "Upcoming Deadline Risk", "Process improvement opportunity")
- **Only includes**: Title + Short message
- **Fast** and **lightweight** detection
- Located in: `kanban/utils/coaching_rules.py`

### 2. **AI-Enhanced Suggestions** (Detailed Format) ü§ñ
- **Starts** as a rule-based suggestion
- **Enhanced** by Google Gemini AI (`AICoachService`)
- **Adds detailed content**:
  - `reasoning` ‚Üí "Why this matters"
  - `recommended_actions` ‚Üí Bullet list of actionable steps with implementation hints
  - `expected_impact` ‚Üí Quantifiable outcomes
  - Additional explainability fields
- Located in: `kanban/utils/ai_coach_service.py`

---

## The Enhancement Process

```
Rule Engine Detects Issue
         ‚Üì
Creates Base Suggestion (title + message)
         ‚Üì
AI Enhancement Check (if Gemini API available)
         ‚Üì
         ‚îú‚îÄ‚îÄ‚Üí YES: Enhanced with AI
         ‚îÇ    - Adds "Why this matters"
         ‚îÇ    - Adds detailed recommended actions
         ‚îÇ    - Adds expected impact
         ‚îÇ    - Adds confidence factors
         ‚îÇ    - Adds alternative approaches
         ‚îÇ    - Changes generation_method to 'hybrid'
         ‚îÇ
         ‚îî‚îÄ‚îÄ‚Üí NO: Remains brief
              - Only title + message shown
              - generation_method stays 'rule'
```

---

## Example: Velocity Drop Suggestion

### Base Rule (Brief)
```python
title = "Team velocity declining (20% drop)"
message = "Your team's velocity has decreased by 20%. This is worth monitoring."
reasoning = "Velocity dropped from 2.5 to 2.0."
recommended_actions = [
    "Monitor velocity trend",
    "Ask team about challenges",
    "Review task complexity"
]
expected_impact = "Early intervention can prevent issues."
```

### After AI Enhancement (Detailed)
The AI adds rich context:

**Why this matters:**
"A 20% decrease in velocity, from 2.5 tasks/week to 2.0 tasks/week, signals a potential problem within the team or the development process. While a single data point isn't cause for panic, it warrants investigation to prevent further decline and maintain project momentum. This drop could stem from various sources, including team member challenges, increased task complexity, or external blockers. Failing to address this could lead to delayed releases, decreased team morale, and ultimately, project failure or compromised quality."

**Recommended Actions:**
1. **Hold a brief team retrospective**
   - Rationale: Safe space to discuss what went well and didn't
   - Expected outcome: Identify impediments or process inefficiencies
   - Implementation: 30-60 minutes, psychological safety, time-boxed

2. **Review the current sprint/week's task breakdown**
   - Rationale: Tasks could be more complex than estimated
   - Expected outcome: Identify task estimation issues
   - Implementation: Compare actual vs estimated effort

3. **Start, Stop, Continue exercise**
   - Rationale: Encourages honest feedback
   - Expected outcome: Uncover process inefficiencies
   - Implementation: Simple format for psychological safety

**Expected Impact:**
"Addressing the velocity drop can lead to improved team morale, increased productivity, and more accurate project forecasting. Resolving bottlenecks and addressing impediments will allow the team to work more efficiently."

---

## Why Brief Suggestions Exist

**Performance & Cost:**
- AI API calls cost money (Gemini API)
- AI enhancement takes time (~1-3 seconds per suggestion)
- Some issues are simple and don't need detailed analysis

**Current System Logic:**
```python
# In coach_views.py - generate_suggestions()

# Step 1: Rule engine creates base suggestions
suggestions_data = rule_engine.analyze_and_generate_suggestions()

# Step 2: Try to enhance with AI
ai_coach = AICoachService()  # Checks if GEMINI_API_KEY exists

for suggestion_data in suggestions_data:
    # This enhancement happens IF Gemini is configured
    suggestion_data = ai_coach.enhance_suggestion_with_ai(
        suggestion_data, context
    )
```

---

## How to Get More Detailed Suggestions

### Option 1: Enable AI Enhancement (Recommended) ‚úÖ

**Configure Google Gemini API:**

1. Get a Gemini API key from [Google AI Studio](https://makersuite.google.com/app/apikey)

2. Add to your Django settings (`.env` or `settings.py`):
```python
GEMINI_API_KEY = 'your-api-key-here'
```

3. Restart the server

4. All new suggestions will automatically be enhanced with detailed content!

### Option 2: Update Rule Engine to Always Include Details

Modify the rule engine to generate more detailed base suggestions even without AI:

**File:** `kanban/utils/coaching_rules.py`

**Change:** Add more detailed actions to each `_add_suggestion()` call

**Example:**
```python
# Instead of brief actions:
recommended_actions=[
    "Monitor trend",
    "Ask team",
]

# Write detailed actions:
recommended_actions=[
    "Schedule a 30-minute team retrospective within the next 2 days. Focus on identifying blockers and process inefficiencies. Use a 'Start, Stop, Continue' format.",
    "Review the current sprint's task breakdown to identify if tasks are more complex than estimated. Compare actual effort vs. estimated effort.",
    "Conduct 1-on-1 check-ins with each team member to identify personal blockers, skill gaps, or external distractions affecting productivity.",
]
```

### Option 3: Batch Enhancement Command

Run manual AI enhancement for existing suggestions:

```bash
python manage.py generate_coach_suggestions --use-ai --board-id=<board_id>
```

This will re-generate all suggestions with AI enhancement.

---

## Database Fields Used

The detailed format leverages these `CoachingSuggestion` model fields:

| Field | Brief Format | Detailed Format |
|-------|-------------|-----------------|
| `title` | ‚úì Always | ‚úì Always |
| `message` | ‚úì Always | ‚úì Always |
| `reasoning` | Often empty | ‚úì Detailed explanation |
| `recommended_actions` | Basic list | ‚úì Detailed with rationale |
| `expected_impact` | Generic | ‚úì Quantifiable outcomes |
| `generation_method` | 'rule' | 'hybrid' or 'ai' |
| `ai_model_used` | 'rule-engine' | 'gemini-2.0-flash-exp' |
| `confidence_score` | Base score | Adjusted by AI |

---

## Template Display Logic

**File:** `templates/kanban/partials/suggestion_card.html`

The template **conditionally displays** detailed sections:

```django
{# Always shown #}
<h3>{{ suggestion.title }}</h3>
<p>{{ suggestion.message }}</p>

{# Only shown if reasoning exists (AI-enhanced) #}
{% if suggestion.reasoning %}
<div class="reasoning-section">
    <strong>Why this matters:</strong>
    <p>{{ suggestion.reasoning }}</p>
</div>
{% endif %}

{# Only shown if actions exist (AI-enhanced) #}
{% if suggestion.recommended_actions %}
<div>
    <strong>Recommended Actions:</strong>
    <ul>
        {% for action in suggestion.recommended_actions %}
        <li>{{ action }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{# Only shown if impact exists (AI-enhanced) #}
{% if suggestion.expected_impact %}
<div class="impact-badge">
    <strong>Expected Impact:</strong> {{ suggestion.expected_impact }}
</div>
{% endif %}
```

**This is why**: Brief suggestions only show title + message, while AI-enhanced ones show the full detailed sections.

---

## Recommendation: Enable AI Enhancement

Based on your feedback that detailed suggestions are "very useful," I recommend:

### ‚úÖ **Enable Google Gemini API**

**Benefits:**
- All suggestions become detailed and actionable
- Contextual advice based on your specific project metrics
- Transparent reasoning for every recommendation
- Alternative approaches and tradeoff analysis
- Confidence factors explained
- Risk of inaction clearly stated

**Cost:**
- Gemini API is **free** up to 15 requests/minute
- For most teams: ~10-20 suggestions/day = negligible cost
- Much cheaper than ChatGPT API

**Setup (2 minutes):**

1. Visit: https://makersuite.google.com/app/apikey
2. Create API key
3. Add to `.env`:
   ```
   GEMINI_API_KEY=your-key-here
   ```
4. Restart Django server

**Verify it's working:**
```python
# In Django shell
from kanban.utils.ai_coach_service import AICoachService
coach = AICoachService()
print(coach.gemini_available)  # Should print: True
```

---

## Future Enhancement Opportunities

1. **Configurable Enhancement Level**
   - Add setting: `AI_ENHANCEMENT_LEVEL = 'none'|'basic'|'full'`
   - Allow users to choose detail level per suggestion type

2. **Selective Enhancement**
   - Only enhance HIGH/CRITICAL severity suggestions
   - Keep INFO/LOW suggestions brief

3. **Caching AI Responses**
   - Cache similar suggestions to reduce API calls
   - Reuse insights for similar situations

4. **User Preference**
   - Allow users to toggle "Show detailed suggestions" in settings
   - Store preference per user

---

## Summary

| Aspect | Current Behavior | Your Preference |
|--------|-----------------|-----------------|
| **Most suggestions** | Brief (rule-based) | ‚ùå Less useful |
| **Velocity drop example** | Detailed (AI-enhanced) | ‚úÖ Very useful |
| **Why the difference?** | Gemini API may not be configured for all suggestions | - |
| **Solution** | Configure `GEMINI_API_KEY` | ‚úÖ All become detailed |
| **Cost** | Free (Gemini's free tier) | ‚úÖ Acceptable |
| **Implementation time** | 2 minutes | ‚úÖ Quick win |

---

## Conclusion

The detailed suggestion you found useful is **AI-enhanced** using Google Gemini. The brief suggestions are **rule-based only**. 

**To get all suggestions in the detailed format:** Enable Gemini API integration by adding your API key to the settings.

This will transform all suggestions from simple one-liners into comprehensive, actionable coaching advice with transparent reasoning‚Äîexactly the format you found valuable!

---

*Document created for understanding AI Coach suggestion format differences*
*Date: January 23, 2026*
